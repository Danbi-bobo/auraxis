{% comment %}
  Snippet: card-product-mix.liquid
  Logic: Giữ ảnh gốc (có hover), Custom giá (Saved), Xóa nút Add to cart.
{% endcomment %}

{%- if product and product != empty -%}
  {%- liquid
    assign ratio = 1
    if product.featured_media and media_aspect_ratio == 'portrait'
      assign ratio = 0.8
    elsif product.featured_media and media_aspect_ratio == 'adapt'
      assign ratio = product.featured_media.aspect_ratio
    endif
    if ratio == 0 or ratio == nil
      assign ratio = 1
    endif
  -%}

  <div class="card-wrapper product-card-wrapper underline-links-hover">
    <div class="card card--standard card--media" style="--ratio-percent: {{ 1 | divided_by: ratio | times: 100 }}%;">
      
      <div class="card__inner color-{{ settings.card_color_scheme }} gradient" style="--ratio-percent: {{ 1 | divided_by: ratio | times: 100 }}%;">
        {%- if product.featured_media -%}
          <div class="card__media">
            <div class="media media--transparent media--hover-effect">
              {% comment %} Ảnh chính {% endcomment %}
              <img
                src="{{ product.featured_media | image_url: width: 533 }}"
                alt="{{ product.featured_media.alt | escape }}"
                class="motion-reduce"
                loading="lazy"
                width="{{ product.featured_media.width }}"
                height="{{ product.featured_media.height }}"
              >
              {% comment %} Ảnh thứ 2 (Hover) {% endcomment %}
              {%- if product.media[1] != nil -%}
                <img
                  src="{{ product.media[1] | image_url: width: 533 }}"
                  alt="{{ product.media[1].alt | escape }}"
                  class="motion-reduce"
                  loading="lazy"
                  width="{{ product.media[1].width }}"
                  height="{{ product.media[1].height }}"
                >
              {%- endif -%}
            </div>
          </div>
        {%- endif -%}

        <div class="card__content">
          <div class="card__badge {{ settings.badge_position }}">
            {%- if product.available == false -%}
              <span id="Badge-{{ section_id }}-{{ product.id }}" class="badge badge--bottom-left color-{{ settings.sold_out_badge_color_scheme }}">
                {{ 'products.product.sold_out' | t }}
              </span>
            {%- elsif product.compare_at_price > product.price -%}
              <span id="Badge-{{ section_id }}-{{ product.id }}" class="badge badge--bottom-left color-{{ settings.sale_badge_color_scheme }}">
                -{{ product.compare_at_price | minus: product.price | times: 100.0 | divided_by: product.compare_at_price | round }}%
              </span>
            {%- endif -%}
          </div>
        </div>
      </div>

      <div class="card__content">
        <div class="card__information">
          
          <h3 class="card__heading h5">
            <a href="{{ product.url }}" class="full-unstyled-link">
              {{ product.title | escape }}
            </a>
          </h3>

          <div class="card-information">
            <div class="price">
              <div class="price__container">
                
                {%- if product.compare_at_price > product.price -%}
                  <div class="price__sale">
                    <span class="price-item price-item--sale price-item--last" style="color: #B12704; font-weight: bold; font-size: 16px;">
                      {{ product.price | money }}
                    </span>
                    <span class="price-item price-item--regular" style="text-decoration: line-through; color: #565959; font-size: 13px; margin-left: 6px;">
                      {{ product.compare_at_price | money }}
                    </span>
                    <div class="price-saved" style="font-size: 12px; color: #B12704; margin-top: 4px; font-weight: 500;">
                      You save: {{ product.compare_at_price | minus: product.price | money }}
                    </div>
                  </div>

                {%- else -%}
                  <div class="price__regular">
                    <span class="price-item price-item--regular" style="font-weight: bold; font-size: 16px; color: #000;">
                      {{ product.price | money }}
                    </span>
                  </div>
                {%- endif -%}

              </div>
            </div>
          </div>
          
          </div>
      </div>
    </div>
  </div>
{%- endif -%}