{% doc %}
  @prompt
    Create a customer testimonial video section with a customizable heading, description text, and a grid layout displaying 3-5 videos per row. Include settings to customize text colors, font sizes, video dimensions, and spacing. The section should support video embeds (YouTube/Vimeo) or uploaded video files, with play buttons overlaid on video thumbnails.
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-testimonial-video-{{ ai_gen_id }} {
    padding: {{ block.settings.section_padding_top }}px 0 {{ block.settings.section_padding_bottom }}px;
    background-color: {{ block.settings.background_color }};
  }

  .ai-testimonial-video-container-{{ ai_gen_id }} {
    max-width: {{ block.settings.container_width }}px;
    margin: 0 auto;
    padding: 0 20px;
  }

  .ai-testimonial-video-header-{{ ai_gen_id }} {
    text-align: {{ block.settings.text_alignment }};
    margin-bottom: {{ block.settings.header_spacing }}px;
  }

  .ai-testimonial-video-heading-{{ ai_gen_id }} {
    font-size: {{ block.settings.heading_size }}px;
    color: {{ block.settings.heading_color }};
    margin: 0 0 {{ block.settings.heading_spacing }}px;
  }

  .ai-testimonial-video-description-{{ ai_gen_id }} {
    font-size: {{ block.settings.description_size }}px;
    color: {{ block.settings.description_color }};
    margin: 0;
    max-width: 800px;
    {% if block.settings.text_alignment == 'center' %}
      margin-left: auto;
      margin-right: auto;
    {% elsif block.settings.text_alignment == 'right' %}
      margin-left: auto;
    {% endif %}
  }

  .ai-testimonial-video-grid-{{ ai_gen_id }} {
    display: grid;
    grid-template-columns: repeat({{ block.settings.videos_per_row }}, 1fr);
    gap: {{ block.settings.grid_gap }}px;
    margin-top: {{ block.settings.grid_spacing }}px;
  }

  .ai-testimonial-video-item-{{ ai_gen_id }} {
    position: relative;
    width: 100%;
    overflow: hidden;
    border-radius: {{ block.settings.video_border_radius }}px;
    background-color: #000000;
  }

  .ai-testimonial-video-wrapper-{{ ai_gen_id }} {
    position: relative;
    width: 100%;
    padding-bottom: {{ block.settings.video_aspect_ratio }}%;
    background-color: #000000;
  }

  .ai-testimonial-video-iframe-{{ ai_gen_id }} {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
  }

  .ai-testimonial-video-native-{{ ai_gen_id }} {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .ai-testimonial-video-thumbnail-{{ ai_gen_id }} {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    cursor: pointer;
    transition: opacity 0.3s ease;
  }

  .ai-testimonial-video-thumbnail-{{ ai_gen_id }}:hover {
    opacity: 0.9;
  }

  .ai-testimonial-video-thumbnail-img-{{ ai_gen_id }} {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .ai-testimonial-video-play-button-{{ ai_gen_id }} {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: {{ block.settings.play_button_size }}px;
    height: {{ block.settings.play_button_size }}px;
    background-color: {{ block.settings.play_button_bg_color }};
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: transform 0.3s ease, background-color 0.3s ease;
    pointer-events: none;
  }

  .ai-testimonial-video-thumbnail-{{ ai_gen_id }}:hover .ai-testimonial-video-play-button-{{ ai_gen_id }} {
    transform: translate(-50%, -50%) scale(1.1);
    background-color: {{ block.settings.play_button_hover_color }};
  }

  .ai-testimonial-video-play-icon-{{ ai_gen_id }} {
    width: 0;
    height: 0;
    border-left: {{ block.settings.play_button_size | divided_by: 3 }}px solid {{ block.settings.play_button_icon_color }};
    border-top: {{ block.settings.play_button_size | divided_by: 4 }}px solid transparent;
    border-bottom: {{ block.settings.play_button_size | divided_by: 4 }}px solid transparent;
    margin-left: {{ block.settings.play_button_size | divided_by: 12 }}px;
  }

  .ai-testimonial-video-placeholder-{{ ai_gen_id }} {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #f4f4f4;
  }

  .ai-testimonial-video-placeholder-{{ ai_gen_id }} svg {
    width: 60%;
    height: 60%;
    opacity: 0.3;
  }

  .ai-testimonial-video-customer-info-{{ ai_gen_id }} {
    padding: {{ block.settings.info_padding }}px;
    text-align: {{ block.settings.text_alignment }};
  }

  .ai-testimonial-video-customer-name-{{ ai_gen_id }} {
    font-size: {{ block.settings.name_size }}px;
    color: {{ block.settings.name_color }};
    font-weight: 600;
    margin: 0 0 4px;
  }

  .ai-testimonial-video-customer-title-{{ ai_gen_id }} {
    font-size: {{ block.settings.title_size }}px;
    color: {{ block.settings.title_color }};
    margin: 0;
  }

  @media screen and (max-width: 989px) {
    .ai-testimonial-video-grid-{{ ai_gen_id }} {
      grid-template-columns: repeat({{ block.settings.videos_per_row_tablet }}, 1fr);
    }

    .ai-testimonial-video-heading-{{ ai_gen_id }} {
      font-size: {{ block.settings.heading_size | times: 0.8 }}px;
    }

    .ai-testimonial-video-description-{{ ai_gen_id }} {
      font-size: {{ block.settings.description_size | times: 0.9 }}px;
    }
  }

  @media screen and (max-width: 749px) {
    .ai-testimonial-video-grid-{{ ai_gen_id }} {
      grid-template-columns: repeat({{ block.settings.videos_per_row_mobile }}, 1fr);
    }

    .ai-testimonial-video-heading-{{ ai_gen_id }} {
      font-size: {{ block.settings.heading_size | times: 0.7 }}px;
    }

    .ai-testimonial-video-description-{{ ai_gen_id }} {
      font-size: {{ block.settings.description_size | times: 0.85 }}px;
    }

    .ai-testimonial-video-play-button-{{ ai_gen_id }} {
      width: {{ block.settings.play_button_size | times: 0.8 }}px;
      height: {{ block.settings.play_button_size | times: 0.8 }}px;
    }

    .ai-testimonial-video-play-icon-{{ ai_gen_id }} {
      border-left-width: {{ block.settings.play_button_size | times: 0.8 | divided_by: 3 }}px;
      border-top-width: {{ block.settings.play_button_size | times: 0.8 | divided_by: 4 }}px;
      border-bottom-width: {{ block.settings.play_button_size | times: 0.8 | divided_by: 4 }}px;
      margin-left: {{ block.settings.play_button_size | times: 0.8 | divided_by: 12 }}px;
    }
  }
{% endstyle %}

<testimonial-videos-{{ ai_gen_id }} class="ai-testimonial-video-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <div class="ai-testimonial-video-container-{{ ai_gen_id }}">
    {% if block.settings.heading != blank or block.settings.description != blank %}
      <div class="ai-testimonial-video-header-{{ ai_gen_id }}">
        {% if block.settings.heading != blank %}
          <h2 class="ai-testimonial-video-heading-{{ ai_gen_id }}">{{ block.settings.heading }}</h2>
        {% endif %}
        {% if block.settings.description != blank %}
          <div class="ai-testimonial-video-description-{{ ai_gen_id }}">{{ block.settings.description }}</div>
        {% endif %}
      </div>
    {% endif %}

    <div class="ai-testimonial-video-grid-{{ ai_gen_id }}">
      {% for i in (1..5) %}
        {% liquid
          assign video_url_key = 'video_url_' | append: i
          assign video_file_key = 'video_file_' | append: i
          assign customer_name_key = 'customer_name_' | append: i
          assign customer_title_key = 'customer_title_' | append: i

          assign video_url = block.settings[video_url_key]
          assign video_file = block.settings[video_file_key]
          assign customer_name = block.settings[customer_name_key]
          assign customer_title = block.settings[customer_title_key]

          assign has_video = false
          assign video_id = ''
          assign video_type = ''

          if video_url != blank
            assign has_video = true
            if video_url contains 'youtube.com' or video_url contains 'youtu.be'
              assign video_type = 'youtube'
              if video_url contains 'youtu.be/'
                assign video_id = video_url | split: 'youtu.be/' | last | split: '?' | first
              elsif video_url contains 'watch?v='
                assign video_id = video_url | split: 'watch?v=' | last | split: '&' | first
              elsif video_url contains 'embed/'
                assign video_id = video_url | split: 'embed/' | last | split: '?' | first
              endif
            elsif video_url contains 'vimeo.com'
              assign video_type = 'vimeo'
              assign video_id = video_url | split: 'vimeo.com/' | last | split: '?' | first
            endif
          elsif video_file != blank
            assign has_video = true
            assign video_type = 'native'
          endif
        %}

        {% if has_video %}
          <div class="ai-testimonial-video-item-{{ ai_gen_id }}" data-video-index="{{ i }}">
            <div class="ai-testimonial-video-wrapper-{{ ai_gen_id }}">
              {% if video_type == 'youtube' %}
                <div
                  class="ai-testimonial-video-thumbnail-{{ ai_gen_id }}"
                  data-video-type="youtube"
                  data-video-id="{{ video_id }}"
                >
                  <img
                    class="ai-testimonial-video-thumbnail-img-{{ ai_gen_id }}"
                    src="https://img.youtube.com/vi/{{ video_id }}/maxresdefault.jpg"
                    alt="{% if customer_name != blank %}{{ customer_name }}{% else %}Video thumbnail{% endif %}"
                    loading="lazy"
                  >
                  <div class="ai-testimonial-video-play-button-{{ ai_gen_id }}">
                    <div class="ai-testimonial-video-play-icon-{{ ai_gen_id }}"></div>
                  </div>
                </div>
              {% elsif video_type == 'vimeo' %}
                <div
                  class="ai-testimonial-video-thumbnail-{{ ai_gen_id }}"
                  data-video-type="vimeo"
                  data-video-id="{{ video_id }}"
                >
                  <div class="ai-testimonial-video-placeholder-{{ ai_gen_id }}">
                    {{ 'image' | placeholder_svg_tag }}
                  </div>
                  <div class="ai-testimonial-video-play-button-{{ ai_gen_id }}">
                    <div class="ai-testimonial-video-play-icon-{{ ai_gen_id }}"></div>
                  </div>
                </div>
              {% elsif video_type == 'native' %}
                <video
                  class="ai-testimonial-video-native-{{ ai_gen_id }}"
                  controls
                  preload="metadata"
                >
                  <source src="{{ video_file }}" type="video/mp4">
                  Your browser does not support the video tag.
                </video>
              {% endif %}
            </div>

            {% if customer_name != blank or customer_title != blank %}
              <div class="ai-testimonial-video-customer-info-{{ ai_gen_id }}">
                {% if customer_name != blank %}
                  <div class="ai-testimonial-video-customer-name-{{ ai_gen_id }}">{{ customer_name }}</div>
                {% endif %}
                {% if customer_title != blank %}
                  <div class="ai-testimonial-video-customer-title-{{ ai_gen_id }}">{{ customer_title }}</div>
                {% endif %}
              </div>
            {% endif %}
          </div>
        {% endif %}
      {% endfor %}
    </div>
  </div>
</testimonial-videos-{{ ai_gen_id }}>

<script>
  (function() {
    class TestimonialVideos{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
      }

      connectedCallback() {
        this.thumbnails = this.querySelectorAll('.ai-testimonial-video-thumbnail-{{ ai_gen_id }}');
        this.setupEventListeners();
      }

      setupEventListeners() {
        this.thumbnails.forEach((thumbnail) => {
          thumbnail.addEventListener('click', () => {
            const videoType = thumbnail.getAttribute('data-video-type');
            const videoId = thumbnail.getAttribute('data-video-id');
            
            if (videoType === 'youtube') {
              this.loadYouTubeVideo(thumbnail, videoId);
            } else if (videoType === 'vimeo') {
              this.loadVimeoVideo(thumbnail, videoId);
            }
          });
        });
      }

      loadYouTubeVideo(thumbnail, videoId) {
        const wrapper = thumbnail.parentElement;
        const iframe = document.createElement('iframe');
        iframe.className = 'ai-testimonial-video-iframe-{{ ai_gen_id }}';
        iframe.src = 'https://www.youtube.com/embed/' + videoId + '?autoplay=1&rel=0';
        iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
        iframe.allowFullscreen = true;
        
        thumbnail.remove();
        wrapper.appendChild(iframe);
      }

      loadVimeoVideo(thumbnail, videoId) {
        const wrapper = thumbnail.parentElement;
        const iframe = document.createElement('iframe');
        iframe.className = 'ai-testimonial-video-iframe-{{ ai_gen_id }}';
        iframe.src = 'https://player.vimeo.com/video/' + videoId + '?autoplay=1';
        iframe.allow = 'autoplay; fullscreen; picture-in-picture';
        iframe.allowFullscreen = true;
        
        thumbnail.remove();
        wrapper.appendChild(iframe);
      }
    }

    customElements.define('testimonial-videos-{{ ai_gen_id }}', TestimonialVideos{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Testimonial videos",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Section header"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Customer testimonials"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "Hear what our customers have to say about their experience"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Text alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "center"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "container_width",
      "min": 1000,
      "max": 2000,
      "step": 10,
      "unit": "px",
      "label": "Container width",
      "default": 1410
    },
    {
      "type": "range",
      "id": "videos_per_row",
      "min": 3,
      "max": 5,
      "step": 1,
      "label": "Videos per row",
      "default": 3
    },
    {
      "type": "select",
      "id": "videos_per_row_tablet",
      "label": "Videos per row on tablet",
      "options": [
        {
          "value": "1",
          "label": "1"
        },
        {
          "value": "2",
          "label": "2"
        },
        {
          "value": "3",
          "label": "3"
        }
      ],
      "default": "2"
    },
    {
      "type": "select",
      "id": "videos_per_row_mobile",
      "label": "Videos per row on mobile",
      "options": [
        {
          "value": "1",
          "label": "1"
        },
        {
          "value": "2",
          "label": "2"
        }
      ],
      "default": "1"
    },
    {
      "type": "range",
      "id": "grid_gap",
      "min": 10,
      "max": 60,
      "step": 2,
      "unit": "px",
      "label": "Grid gap",
      "default": 24
    },
    {
      "type": "range",
      "id": "grid_spacing",
      "min": 20,
      "max": 80,
      "step": 4,
      "unit": "px",
      "label": "Grid spacing",
      "default": 40
    },
    {
      "type": "header",
      "content": "Video style"
    },
    {
      "type": "range",
      "id": "video_aspect_ratio",
      "min": 50,
      "max": 100,
      "step": 5,
      "unit": "%",
      "label": "Video aspect ratio",
      "default": 75
    },
    {
      "type": "range",
      "id": "video_border_radius",
      "min": 0,
      "max": 30,
      "step": 2,
      "unit": "px",
      "label": "Video border radius",
      "default": 8
    },
    {
      "type": "header",
      "content": "Play button"
    },
    {
      "type": "range",
      "id": "play_button_size",
      "min": 40,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Play button size",
      "default": 72
    },
    {
      "type": "color",
      "id": "play_button_bg_color",
      "label": "Background color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "play_button_hover_color",
      "label": "Hover background color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "play_button_icon_color",
      "label": "Icon color",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "range",
      "id": "heading_size",
      "min": 20,
      "max": 60,
      "step": 2,
      "unit": "px",
      "label": "Heading size",
      "default": 36
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "heading_spacing",
      "min": 8,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Heading spacing",
      "default": 16
    },
    {
      "type": "range",
      "id": "description_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Description size",
      "default": 16
    },
    {
      "type": "color",
      "id": "description_color",
      "label": "Description color",
      "default": "#666666"
    },
    {
      "type": "range",
      "id": "header_spacing",
      "min": 20,
      "max": 80,
      "step": 4,
      "unit": "px",
      "label": "Header spacing",
      "default": 40
    },
    {
      "type": "header",
      "content": "Customer info"
    },
    {
      "type": "range",
      "id": "info_padding",
      "min": 8,
      "max": 32,
      "step": 2,
      "unit": "px",
      "label": "Info padding",
      "default": 16
    },
    {
      "type": "range",
      "id": "name_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Name size",
      "default": 16
    },
    {
      "type": "color",
      "id": "name_color",
      "label": "Name color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "title_size",
      "min": 10,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Title size",
      "default": 14
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title color",
      "default": "#666666"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "section_padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top padding",
      "default": 60
    },
    {
      "type": "range",
      "id": "section_padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding",
      "default": 60
    },
    {
      "type": "header",
      "content": "Video 1"
    },
    {
      "type": "text",
      "id": "video_url_1",
      "label": "Video URL",
      "info": "YouTube or Vimeo URL"
    },
    {
      "type": "video_url",
      "id": "video_file_1",
      "label": "Video file",
      "accept": ["youtube", "vimeo"]
    },
    {
      "type": "text",
      "id": "customer_name_1",
      "label": "Customer name"
    },
    {
      "type": "text",
      "id": "customer_title_1",
      "label": "Customer title"
    },
    {
      "type": "header",
      "content": "Video 2"
    },
    {
      "type": "text",
      "id": "video_url_2",
      "label": "Video URL",
      "info": "YouTube or Vimeo URL"
    },
    {
      "type": "video_url",
      "id": "video_file_2",
      "label": "Video file",
      "accept": ["youtube", "vimeo"]
    },
    {
      "type": "text",
      "id": "customer_name_2",
      "label": "Customer name"
    },
    {
      "type": "text",
      "id": "customer_title_2",
      "label": "Customer title"
    },
    {
      "type": "header",
      "content": "Video 3"
    },
    {
      "type": "text",
      "id": "video_url_3",
      "label": "Video URL",
      "info": "YouTube or Vimeo URL"
    },
    {
      "type": "video_url",
      "id": "video_file_3",
      "label": "Video file",
      "accept": ["youtube", "vimeo"]
    },
    {
      "type": "text",
      "id": "customer_name_3",
      "label": "Customer name"
    },
    {
      "type": "text",
      "id": "customer_title_3",
      "label": "Customer title"
    },
    {
      "type": "header",
      "content": "Video 4"
    },
    {
      "type": "text",
      "id": "video_url_4",
      "label": "Video URL",
      "info": "YouTube or Vimeo URL"
    },
    {
      "type": "video_url",
      "id": "video_file_4",
      "label": "Video file",
      "accept": ["youtube", "vimeo"]
    },
    {
      "type": "text",
      "id": "customer_name_4",
      "label": "Customer name"
    },
    {
      "type": "text",
      "id": "customer_title_4",
      "label": "Customer title"
    },
    {
      "type": "header",
      "content": "Video 5"
    },
    {
      "type": "text",
      "id": "video_url_5",
      "label": "Video URL",
      "info": "YouTube or Vimeo URL"
    },
    {
      "type": "video_url",
      "id": "video_file_5",
      "label": "Video file",
      "accept": ["youtube", "vimeo"]
    },
    {
      "type": "text",
      "id": "customer_name_5",
      "label": "Customer name"
    },
    {
      "type": "text",
      "id": "customer_title_5",
      "label": "Customer title"
    }
  ],
  "presets": [
    {
      "name": "Testimonial videos"
    }
  ]
}
{% endschema %}
