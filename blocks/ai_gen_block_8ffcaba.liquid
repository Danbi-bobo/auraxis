{% doc %}
  @prompt
    Create a customer testimonial video gallery section with heading and description. Display 3-5 videos in a responsive grid layout. Each video should use HTML5 video player or iframe embeds for YouTube/Vimeo. Include custom play button overlay on video thumbnails. Add settings for: text colors, font sizes, video aspect ratio, grid columns, and spacing. Ensure videos are properly embedded and playable., chưa có kích thước dọc 4:5 và 9:16
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-video-gallery-{{ ai_gen_id }} {
    padding: {{ block.settings.section_padding_top }}px 0 {{ block.settings.section_padding_bottom }}px;
    background-color: {{ block.settings.background_color }};
  }

  .ai-video-gallery-container-{{ ai_gen_id }} {
    max-width: {{ block.settings.container_width }}px;
    margin: 0 auto;
    padding: 0 20px;
  }

  .ai-video-gallery-header-{{ ai_gen_id }} {
    text-align: {{ block.settings.text_alignment }};
    margin-bottom: {{ block.settings.header_spacing }}px;
  }

  .ai-video-gallery-heading-{{ ai_gen_id }} {
    font-size: {{ block.settings.heading_size }}px;
    color: {{ block.settings.heading_color }};
    margin: 0 0 16px;
    line-height: 1.2;
  }

  .ai-video-gallery-description-{{ ai_gen_id }} {
    font-size: {{ block.settings.description_size }}px;
    color: {{ block.settings.description_color }};
    margin: 0;
    line-height: 1.6;
  }

  .ai-video-gallery-grid-{{ ai_gen_id }} {
    display: grid;
    grid-template-columns: repeat({{ block.settings.columns_desktop }}, 1fr);
    gap: {{ block.settings.grid_gap }}px;
  }

  .ai-video-item-{{ ai_gen_id }} {
    position: relative;
    width: 100%;
    background-color: {{ block.settings.video_card_bg }};
    border-radius: 8px;
    overflow: hidden;
  }

  .ai-video-wrapper-{{ ai_gen_id }} {
    position: relative;
    width: 100%;
    padding-bottom: {{ block.settings.video_aspect_ratio }};
    background-color: #000000;
    overflow: hidden;
  }

  .ai-video-wrapper-{{ ai_gen_id }} iframe,
  .ai-video-wrapper-{{ ai_gen_id }} video {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
  }

  .ai-video-thumbnail-{{ ai_gen_id }} {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    cursor: pointer;
    transition: opacity 0.3s ease;
  }

  .ai-video-thumbnail-{{ ai_gen_id }}:hover {
    opacity: 0.8;
  }

  .ai-video-play-button-{{ ai_gen_id }} {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: {{ block.settings.play_button_size }}px;
    height: {{ block.settings.play_button_size }}px;
    background-color: {{ block.settings.play_button_bg }};
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 2;
    border: none;
    padding: 0;
  }

  .ai-video-play-button-{{ ai_gen_id }}:hover {
    transform: translate(-50%, -50%) scale(1.1);
    background-color: {{ block.settings.play_button_hover_bg }};
  }

  .ai-video-play-icon-{{ ai_gen_id }} {
    width: calc({{ block.settings.play_button_size }}px * 0.4);
    height: calc({{ block.settings.play_button_size }}px * 0.4);
    margin-left: 4px;
  }

  .ai-video-play-icon-{{ ai_gen_id }} polygon {
    fill: {{ block.settings.play_button_icon_color }};
  }

  .ai-video-info-{{ ai_gen_id }} {
    padding: 16px;
  }

  .ai-video-customer-name-{{ ai_gen_id }} {
    font-size: {{ block.settings.customer_name_size }}px;
    font-weight: 600;
    color: {{ block.settings.customer_name_color }};
    margin: 0 0 4px;
  }

  .ai-video-customer-title-{{ ai_gen_id }} {
    font-size: {{ block.settings.customer_title_size }}px;
    color: {{ block.settings.customer_title_color }};
    margin: 0;
  }

  .ai-video-hidden-{{ ai_gen_id }} {
    display: none;
  }

  @media screen and (max-width: 989px) {
    .ai-video-gallery-grid-{{ ai_gen_id }} {
      grid-template-columns: repeat({{ block.settings.columns_tablet }}, 1fr);
    }

    .ai-video-gallery-heading-{{ ai_gen_id }} {
      font-size: calc({{ block.settings.heading_size }}px * 0.8);
    }

    .ai-video-gallery-description-{{ ai_gen_id }} {
      font-size: calc({{ block.settings.description_size }}px * 0.9);
    }
  }

  @media screen and (max-width: 749px) {
    .ai-video-gallery-grid-{{ ai_gen_id }} {
      grid-template-columns: 1fr;
    }

    .ai-video-gallery-{{ ai_gen_id }} {
      padding: {{ block.settings.section_padding_top | times: 0.7 }}px 0 {{ block.settings.section_padding_bottom | times: 0.7 }}px;
    }

    .ai-video-play-button-{{ ai_gen_id }} {
      width: calc({{ block.settings.play_button_size }}px * 0.8);
      height: calc({{ block.settings.play_button_size }}px * 0.8);
    }

    .ai-video-play-icon-{{ ai_gen_id }} {
      width: calc({{ block.settings.play_button_size }}px * 0.32);
      height: calc({{ block.settings.play_button_size }}px * 0.32);
    }
  }
{% endstyle %}

<div class="ai-video-gallery-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <div class="ai-video-gallery-container-{{ ai_gen_id }}">
    {% if block.settings.heading != blank or block.settings.description != blank %}
      <div class="ai-video-gallery-header-{{ ai_gen_id }}">
        {% if block.settings.heading != blank %}
          <h2 class="ai-video-gallery-heading-{{ ai_gen_id }}">{{ block.settings.heading }}</h2>
        {% endif %}
        {% if block.settings.description != blank %}
          <div class="ai-video-gallery-description-{{ ai_gen_id }}">{{ block.settings.description }}</div>
        {% endif %}
      </div>
    {% endif %}

    <div class="ai-video-gallery-grid-{{ ai_gen_id }}">
      {% for i in (1..5) %}
        {% liquid
          assign video_url_key = 'video_url_' | append: i
          assign video_type_key = 'video_type_' | append: i
          assign thumbnail_key = 'video_thumbnail_' | append: i
          assign customer_name_key = 'customer_name_' | append: i
          assign customer_title_key = 'customer_title_' | append: i

          assign video_url = block.settings[video_url_key]
          assign video_type = block.settings[video_type_key]
          assign thumbnail = block.settings[thumbnail_key]
          assign customer_name = block.settings[customer_name_key]
          assign customer_title = block.settings[customer_title_key]
        %}

        {% if video_url != blank %}
          <div class="ai-video-item-{{ ai_gen_id }}">
            <div class="ai-video-wrapper-{{ ai_gen_id }}" data-video-index="{{ i }}">
              {% if video_type == 'youtube' %}
                {% assign video_id = video_url | split: 'v=' | last | split: '&' | first %}
                {% if video_url contains 'youtu.be' %}
                  {% assign video_id = video_url | split: 'youtu.be/' | last | split: '?' | first %}
                {% endif %}
                
                {% if thumbnail %}
                  <img
                    src="{{ thumbnail | image_url: width: 800 }}"
                    alt="{{ customer_name | escape }}"
                    class="ai-video-thumbnail-{{ ai_gen_id }}"
                    loading="lazy"
                    width="800"
                    height="450"
                  >
                {% else %}
                  <img
                    src="https://img.youtube.com/vi/{{ video_id }}/maxresdefault.jpg"
                    alt="{{ customer_name | escape }}"
                    class="ai-video-thumbnail-{{ ai_gen_id }}"
                    loading="lazy"
                    width="800"
                    height="450"
                  >
                {% endif %}

                <button
                  class="ai-video-play-button-{{ ai_gen_id }}"
                  aria-label="Play video"
                  data-video-id="{{ video_id }}"
                  data-video-type="youtube"
                >
                  <svg class="ai-video-play-icon-{{ ai_gen_id }}" viewBox="0 0 24 24">
                    <polygon points="5,3 19,12 5,21"></polygon>
                  </svg>
                </button>

              {% elsif video_type == 'vimeo' %}
                {% assign video_id = video_url | split: 'vimeo.com/' | last | split: '/' | first %}
                
                {% if thumbnail %}
                  <img
                    src="{{ thumbnail | image_url: width: 800 }}"
                    alt="{{ customer_name | escape }}"
                    class="ai-video-thumbnail-{{ ai_gen_id }}"
                    loading="lazy"
                    width="800"
                    height="450"
                  >
                {% endif %}

                <button
                  class="ai-video-play-button-{{ ai_gen_id }}"
                  aria-label="Play video"
                  data-video-id="{{ video_id }}"
                  data-video-type="vimeo"
                >
                  <svg class="ai-video-play-icon-{{ ai_gen_id }}" viewBox="0 0 24 24">
                    <polygon points="5,3 19,12 5,21"></polygon>
                  </svg>
                </button>

              {% elsif video_type == 'html5' %}
                <video
                  class="ai-video-html5-{{ ai_gen_id }}"
                  controls
                  preload="metadata"
                  {% if thumbnail %}
                    poster="{{ thumbnail | image_url: width: 800 }}"
                  {% endif %}
                >
                  <source src="{{ video_url }}" type="video/mp4">
                  Your browser does not support the video tag.
                </video>
              {% endif %}
            </div>

            {% if customer_name != blank or customer_title != blank %}
              <div class="ai-video-info-{{ ai_gen_id }}">
                {% if customer_name != blank %}
                  <div class="ai-video-customer-name-{{ ai_gen_id }}">{{ customer_name }}</div>
                {% endif %}
                {% if customer_title != blank %}
                  <div class="ai-video-customer-title-{{ ai_gen_id }}">{{ customer_title }}</div>
                {% endif %}
              </div>
            {% endif %}
          </div>
        {% endif %}
      {% endfor %}
    </div>
  </div>
</div>

<script>
  (function() {
    class VideoGallery{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.playButtons = this.querySelectorAll('.ai-video-play-button-{{ ai_gen_id }}');
      }

      connectedCallback() {
        this.setupVideoPlayers();
      }

      setupVideoPlayers() {
        this.playButtons.forEach((button) => {
          button.addEventListener('click', (e) => {
            e.preventDefault();
            const videoType = button.getAttribute('data-video-type');
            const videoId = button.getAttribute('data-video-id');
            const wrapper = button.closest('.ai-video-wrapper-{{ ai_gen_id }}');
            const thumbnail = wrapper.querySelector('.ai-video-thumbnail-{{ ai_gen_id }}');

            if (videoType === 'youtube') {
              const iframe = document.createElement('iframe');
              iframe.setAttribute('src', 'https://www.youtube.com/embed/' + videoId + '?autoplay=1&rel=0');
              iframe.setAttribute('frameborder', '0');
              iframe.setAttribute('allow', 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture');
              iframe.setAttribute('allowfullscreen', '');
              iframe.setAttribute('title', 'YouTube video player');
              
              if (thumbnail) {
                thumbnail.classList.add('ai-video-hidden-{{ ai_gen_id }}');
              }
              button.classList.add('ai-video-hidden-{{ ai_gen_id }}');
              wrapper.appendChild(iframe);
            } else if (videoType === 'vimeo') {
              const iframe = document.createElement('iframe');
              iframe.setAttribute('src', 'https://player.vimeo.com/video/' + videoId + '?autoplay=1');
              iframe.setAttribute('frameborder', '0');
              iframe.setAttribute('allow', 'autoplay; fullscreen; picture-in-picture');
              iframe.setAttribute('allowfullscreen', '');
              iframe.setAttribute('title', 'Vimeo video player');
              
              if (thumbnail) {
                thumbnail.classList.add('ai-video-hidden-{{ ai_gen_id }}');
              }
              button.classList.add('ai-video-hidden-{{ ai_gen_id }}');
              wrapper.appendChild(iframe);
            }
          });
        });
      }
    }

    if (!customElements.get('video-gallery-{{ ai_gen_id }}')) {
      customElements.define('video-gallery-{{ ai_gen_id }}', VideoGallery{{ ai_gen_id }});
    }
  })();
</script>

{% schema %}
{
  "name": "Video testimonials",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Customer Testimonials"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "Hear what our customers have to say about their experience"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Text alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "center"
    },
    {
      "type": "header",
      "content": "Video 1"
    },
    {
      "type": "select",
      "id": "video_type_1",
      "label": "Video type",
      "options": [
        {
          "value": "youtube",
          "label": "YouTube"
        },
        {
          "value": "vimeo",
          "label": "Vimeo"
        },
        {
          "value": "html5",
          "label": "HTML5 video"
        }
      ],
      "default": "youtube"
    },
    {
      "type": "text",
      "id": "video_url_1",
      "label": "Video URL"
    },
    {
      "type": "image_picker",
      "id": "video_thumbnail_1",
      "label": "Custom thumbnail"
    },
    {
      "type": "text",
      "id": "customer_name_1",
      "label": "Customer name",
      "default": "Sarah Johnson"
    },
    {
      "type": "text",
      "id": "customer_title_1",
      "label": "Customer title",
      "default": "Verified Customer"
    },
    {
      "type": "header",
      "content": "Video 2"
    },
    {
      "type": "select",
      "id": "video_type_2",
      "label": "Video type",
      "options": [
        {
          "value": "youtube",
          "label": "YouTube"
        },
        {
          "value": "vimeo",
          "label": "Vimeo"
        },
        {
          "value": "html5",
          "label": "HTML5 video"
        }
      ],
      "default": "youtube"
    },
    {
      "type": "text",
      "id": "video_url_2",
      "label": "Video URL"
    },
    {
      "type": "image_picker",
      "id": "video_thumbnail_2",
      "label": "Custom thumbnail"
    },
    {
      "type": "text",
      "id": "customer_name_2",
      "label": "Customer name",
      "default": "Michael Chen"
    },
    {
      "type": "text",
      "id": "customer_title_2",
      "label": "Customer title",
      "default": "Verified Customer"
    },
    {
      "type": "header",
      "content": "Video 3"
    },
    {
      "type": "select",
      "id": "video_type_3",
      "label": "Video type",
      "options": [
        {
          "value": "youtube",
          "label": "YouTube"
        },
        {
          "value": "vimeo",
          "label": "Vimeo"
        },
        {
          "value": "html5",
          "label": "HTML5 video"
        }
      ],
      "default": "youtube"
    },
    {
      "type": "text",
      "id": "video_url_3",
      "label": "Video URL"
    },
    {
      "type": "image_picker",
      "id": "video_thumbnail_3",
      "label": "Custom thumbnail"
    },
    {
      "type": "text",
      "id": "customer_name_3",
      "label": "Customer name",
      "default": "Emily Rodriguez"
    },
    {
      "type": "text",
      "id": "customer_title_3",
      "label": "Customer title",
      "default": "Verified Customer"
    },
    {
      "type": "header",
      "content": "Video 4"
    },
    {
      "type": "select",
      "id": "video_type_4",
      "label": "Video type",
      "options": [
        {
          "value": "youtube",
          "label": "YouTube"
        },
        {
          "value": "vimeo",
          "label": "Vimeo"
        },
        {
          "value": "html5",
          "label": "HTML5 video"
        }
      ],
      "default": "youtube"
    },
    {
      "type": "text",
      "id": "video_url_4",
      "label": "Video URL"
    },
    {
      "type": "image_picker",
      "id": "video_thumbnail_4",
      "label": "Custom thumbnail"
    },
    {
      "type": "text",
      "id": "customer_name_4",
      "label": "Customer name"
    },
    {
      "type": "text",
      "id": "customer_title_4",
      "label": "Customer title"
    },
    {
      "type": "header",
      "content": "Video 5"
    },
    {
      "type": "select",
      "id": "video_type_5",
      "label": "Video type",
      "options": [
        {
          "value": "youtube",
          "label": "YouTube"
        },
        {
          "value": "vimeo",
          "label": "Vimeo"
        },
        {
          "value": "html5",
          "label": "HTML5 video"
        }
      ],
      "default": "youtube"
    },
    {
      "type": "text",
      "id": "video_url_5",
      "label": "Video URL"
    },
    {
      "type": "image_picker",
      "id": "video_thumbnail_5",
      "label": "Custom thumbnail"
    },
    {
      "type": "text",
      "id": "customer_name_5",
      "label": "Customer name"
    },
    {
      "type": "text",
      "id": "customer_title_5",
      "label": "Customer title"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 1,
      "max": 5,
      "step": 1,
      "label": "Columns on desktop",
      "default": 3
    },
    {
      "type": "range",
      "id": "columns_tablet",
      "min": 1,
      "max": 3,
      "step": 1,
      "label": "Columns on tablet",
      "default": 2
    },
    {
      "type": "range",
      "id": "grid_gap",
      "min": 10,
      "max": 50,
      "step": 5,
      "unit": "px",
      "label": "Grid gap",
      "default": 20
    },
    {
      "type": "range",
      "id": "container_width",
      "min": 1000,
      "max": 2000,
      "step": 100,
      "unit": "px",
      "label": "Container width",
      "default": 1400
    },
    {
      "type": "select",
      "id": "video_aspect_ratio",
      "label": "Video aspect ratio",
      "options": [
        {
          "value": "56.25%",
          "label": "16:9"
        },
        {
          "value": "75%",
          "label": "4:3"
        },
        {
          "value": "100%",
          "label": "1:1"
        },
        {
          "value": "125%",
          "label": "4:5"
        },
        {
          "value": "133.33%",
          "label": "3:4"
        },
        {
          "value": "177.78%",
          "label": "9:16"
        }
      ],
      "default": "56.25%"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "description_color",
      "label": "Description",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "video_card_bg",
      "label": "Video card background",
      "default": "#f6f6f6"
    },
    {
      "type": "color",
      "id": "customer_name_color",
      "label": "Customer name",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "customer_title_color",
      "label": "Customer title",
      "default": "#666666"
    },
    {
      "type": "header",
      "content": "Play button"
    },
    {
      "type": "range",
      "id": "play_button_size",
      "min": 40,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Size",
      "default": 70
    },
    {
      "type": "color",
      "id": "play_button_bg",
      "label": "Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "play_button_hover_bg",
      "label": "Hover background",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "play_button_icon_color",
      "label": "Icon color",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "range",
      "id": "heading_size",
      "min": 20,
      "max": 60,
      "step": 2,
      "unit": "px",
      "label": "Heading size",
      "default": 36
    },
    {
      "type": "range",
      "id": "description_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Description size",
      "default": 16
    },
    {
      "type": "range",
      "id": "customer_name_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Customer name size",
      "default": 16
    },
    {
      "type": "range",
      "id": "customer_title_size",
      "min": 10,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Customer title size",
      "default": 14
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "section_padding_top",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Top padding",
      "default": 50
    },
    {
      "type": "range",
      "id": "section_padding_bottom",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Bottom padding",
      "default": 50
    },
    {
      "type": "range",
      "id": "header_spacing",
      "min": 20,
      "max": 80,
      "step": 5,
      "unit": "px",
      "label": "Header spacing",
      "default": 40
    }
  ],
  "presets": [
    {
      "name": "Video testimonials"
    }
  ]
}
{% endschema %}