{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}
{{ 'component-product-grid.css' | asset_url | stylesheet_tag }}

{% liquid
  assign products_to_display = section.settings.collection.all_products_count

  if section.settings.collection.all_products_count > section.settings.products_to_show
    assign products_to_display = section.settings.products_to_show
    assign more_in_collection = true
  endif

  assign columns_mobile_int = section.settings.columns_mobile | plus: 0
  assign show_mobile_slider = false
  if section.settings.swipe_on_mobile and products_to_display > columns_mobile_int
    assign show_mobile_slider = true
  endif

  assign show_desktop_slider = false
  if section.settings.enable_desktop_slider and products_to_display > section.settings.columns_desktop
    assign show_desktop_slider = true
  endif

  assign columns_desktop = section.settings.columns_desktop
  assign columns_tablet = columns_desktop
  if columns_desktop > 3
    assign columns_tablet = columns_desktop | divided_by: 2.0 | ceil
  endif

  assign motion_delay = 50
%}

{%- style -%}
  /* --- AURAGEMS FEATURED COLLECTION STYLES --- */
  .section-{{ section.id }} .card-wrapper {
    height: 100%;
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    border-radius: var(--block-radius, 8px);
    overflow: hidden;
    background: rgb(var(--color-background));
    border: 1px solid rgba(var(--color-foreground), 0.05);
  }

  /* Hiệu ứng Hover Card: Nổi lên và đổ bóng */
  .section-{{ section.id }} .card-wrapper:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 24px rgba(0,0,0,0.08);
    z-index: 2;
    border-color: transparent;
  }

  .section-{{ section.id }} .card__inner {
    border-radius: var(--block-radius, 8px) var(--block-radius, 8px) 0 0;
  }

  /* Nút View All */
  .section-{{ section.id }} .section__footer {
    margin-top: 4rem;
    text-align: center;
  }
  
  /* Slider Controls */
  .section-{{ section.id }} .swiper-controls {
    display: flex;
    gap: 10px;
  }
  .section-{{ section.id }} .swiper-controls button {
    border: 1px solid rgba(var(--color-foreground), 0.1);
    color: rgb(var(--color-foreground));
    background: transparent;
    transition: all 0.2s;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    cursor: pointer;
  }
  .section-{{ section.id }} .swiper-controls button:hover {
    background: rgb(var(--color-foreground));
    color: rgb(var(--color-background));
    border-color: rgb(var(--color-foreground));
  }
  
  /* Grid Fix */
  .section-{{ section.id }} .f-grid {
    display: grid;
    grid-template-columns: repeat({{ columns_mobile_int }}, 1fr);
    gap: 20px;
  }
  
  @media screen and (min-width: 750px) {
    .section-{{ section.id }} .f-grid {
      grid-template-columns: repeat({{ columns_tablet }}, 1fr);
    }
  }
  
  @media screen and (min-width: 990px) {
    .section-{{ section.id }} .f-grid {
      grid-template-columns: repeat({{ columns_desktop }}, 1fr);
    }
  }
  
  /* Slider Overrides if active */
  .section-{{ section.id }} .swiper-wrapper {
    display: flex;
    gap: 0; /* Gap handled by swiper */
  }
  .section-{{ section.id }} .swiper-slide {
    height: auto;
    width: auto; /* Let swiper handle width */
  }
{%- endstyle -%}

{% render 'divider',
  show_divider: section.settings.show_section_divider,
  divider_width: section.settings.divider_width
%}

<div class="section section-{{ section.id }} section--padding color-{{ section.settings.color_scheme }} gradient"
  style="--section-padding-top: {{ section.settings.padding_top }}px;--section-padding-bottom: {{ section.settings.padding_bottom }}px;">
  
  <div class="page-width">
    <div class="section__header spacing--large md:flex justify-between items-end gap-6" style="margin-bottom: 30px;">
      <div class="rich-text text-{{ section.settings.header_alignment_mobile }} md:text-{{ section.settings.header_alignment }}">
        {%- if section.settings.subheading != blank -%}
          <motion-element class="block rich-text__subheading text-subheading" data-motion="fade-up" data-motion-delay="{{ motion_delay }}">
            {{ section.settings.subheading }}
          </motion-element>
          {%- assign motion_delay = motion_delay | plus: 50 -%}
        {%- endif -%}

        {%- if section.settings.title != blank -%}
          <h2 class="rich-text__heading inline-richtext {{ section.settings.heading_size }}">
            <motion-element class="block" data-motion="fade-up" data-motion-delay="{{ motion_delay }}">
              {% render 'highlight-text', text: section.settings.title, style: section.settings.heading_highlight_style %}
            </motion-element>
          </h2>
          {%- assign motion_delay = motion_delay | plus: 50 -%}
        {%- endif -%}

        {%- if section.settings.description != blank -%}
          <motion-element class="block rich-text__text rte {{ section.settings.description_size }}" data-motion="fade-up" data-motion-delay="{{ motion_delay }}">
            {{ section.settings.description }}
          </motion-element>
          {%- assign motion_delay = motion_delay | plus: 50 -%}
        {%- endif -%}
      </div>

      {%- if show_desktop_slider -%}
        <motion-element class="swiper-controls hidden md:inline-flex" data-motion="fade-up" data-motion-delay="{{ motion_delay }}">
          <button type="button" class="swiper-btn-prev btn btn--icon-circle shrink-0" name="previous" aria-label="Previous slide">
            {% render 'icon-slider-prev' %}
          </button>
          <button type="button" class="swiper-btn-next btn btn--icon-circle shrink-0" name="next" aria-label="Next slide">
            {% render 'icon-slider-next' %}
          </button>
        </motion-element>
      {%- endif -%}
    </div>

    <motion-element class="section__content block" data-motion="fade-up" data-motion-delay="{{ motion_delay }}">
      <div 
        class="products-showcase block {% if show_desktop_slider or show_mobile_slider %} swiper{% endif %}{% if show_mobile_slider %} swipe-mobile swipe-mobile--{{ section.settings.columns_mobile }}-cols{% endif %}"
        data-section-id="{{ section.id }}"
        {% if show_desktop_slider %}
          data-enable-slider="true"
          data-items="{{ columns_desktop }}"
          data-tablet-items="{{ columns_tablet }}"
        {% endif %}
      >
        <div class="products-showcase__items {% if show_desktop_slider == false and show_mobile_slider == false %}f-grid{% endif %} {% if show_desktop_slider or show_mobile_slider %} swiper-wrapper{% endif %}{% if show_mobile_slider %} swipe-mobile__inner{% endif %}">
          
          {%- if section.settings.collection != blank and section.settings.collection.all_products_count > 0 -%}
            {%- for product in section.settings.collection.products limit: section.settings.products_to_show -%}
              <div class="f-column {% if show_desktop_slider or show_mobile_slider %} swiper-slide{% endif %}">
                {% render 'card-product',
                  product: product,
                  media_aspect_ratio: section.settings.image_ratio,
                  show_secondary_image: section.settings.show_secondary_image,
                  show_vendor: section.settings.show_vendor,
                  show_rating: section.settings.show_rating,
                  show_quick_add: section.settings.enable_quick_add,
                  section_id: section.id
                %}
              </div>
            {%- endfor -%}
          {%- else -%}
            {%- for i in (1..section.settings.products_to_show) -%}
              <div class="f-column {% if show_desktop_slider or show_mobile_slider %} swiper-slide{% endif %}">
                {% render 'card-product-placeholder', media_aspect_ratio: section.settings.image_ratio %}
              </div>
            {%- endfor -%}
          {%- endif -%}
          
        </div>
      </div>
    </motion-element>

    {%- if section.settings.show_view_all and more_in_collection -%}
      <div class="section__footer">
        <a href="{{ section.settings.collection.url }}"
          class="btn {{ section.settings.view_all_style }}"
          aria-label="{{ 'sections.featured_collection.view_all_label' | t: collection_name: section.settings.collection.title }}"
        >
          {{ 'sections.featured_collection.view_all' | t }}
        </a>
      </div>
    {%- endif -%}
  </div>
</div>

{% schema %}
{
  "name": "Featured Collection",
  "tag": "section",
  "class": "section section-featured-collection",
  "disabled_on": {
    "groups": ["header", "footer", "custom.overlay"]
  },
  "settings": [
    {
      "type": "paragraph",
      "content": "Display products from a specific collection."
    },
    {
      "type": "header",
      "content": "General"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 2,
      "max": 25,
      "step": 1,
      "default": 8,
      "label": "Maximum products to show"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color Scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "Header"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading"
    },
    {
      "type": "inline_richtext",
      "id": "title",
      "default": "Featured Collection",
      "label": "Heading"
    },
    {
      "type": "select",
      "id": "heading_size",
      "options": [
        { "value": "h3", "label": "Small" },
        { "value": "h2", "label": "Medium" },
        { "value": "h1", "label": "Large" }
      ],
      "default": "h2",
      "label": "Heading Size"
    },
    {
      "type": "select",
      "id": "heading_highlight_style",
      "label": "Highlight Style",
      "options": [
        { "value": "none", "label": "None" },
        { "value": "underline", "label": "Underline" }
      ]
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description"
    },
    {
      "type": "select",
      "id": "header_alignment",
      "label": "Desktop Alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ],
      "default": "left"
    },
    {
      "type": "header",
      "content": "Grid & Slider"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 2,
      "max": 5,
      "step": 1,
      "default": 4,
      "label": "Columns on Desktop"
    },
    {
      "type": "checkbox",
      "id": "enable_desktop_slider",
      "label": "Enable Slider on Desktop",
      "default": true
    },
    {
      "type": "select",
      "id": "column_gap",
      "options": [
        { "value": "medium", "label": "Medium" },
        { "value": "large", "label": "Large" }
      ],
      "default": "medium",
      "label": "Column Gap"
    },
    {
      "type": "header",
      "content": "Product Card"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "options": [
        { "value": "adapt", "label": "Adapt to image" },
        { "value": "portrait", "label": "Portrait" },
        { "value": "square", "label": "Square" }
      ],
      "default": "adapt",
      "label": "Image Ratio"
    },
    {
      "type": "checkbox",
      "id": "show_secondary_image",
      "default": false,
      "label": "Show second image on hover"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "default": false,
      "label": "Show vendor"
    },
    {
      "type": "checkbox",
      "id": "show_rating",
      "default": false,
      "label": "Show product rating"
    },
    {
      "type": "checkbox",
      "id": "enable_quick_add",
      "default": true,
      "label": "Enable Quick Add Button"
    },
    {
      "type": "header",
      "content": "Mobile Settings"
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "options": [
        { "value": "1", "label": "1 Column" },
        { "value": "2", "label": "2 Columns" }
      ],
      "default": "2",
      "label": "Columns on Mobile"
    },
    {
      "type": "checkbox",
      "id": "swipe_on_mobile",
      "default": true,
      "label": "Enable Swipe on Mobile"
    },
    {
      "type": "header",
      "content": "View All Button"
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "default": true,
      "label": "Show 'View all' button"
    },
    {
      "type": "select",
      "id": "view_all_style",
      "label": "Button Style",
      "options": [
        { "value": "btn--primary", "label": "Primary" },
        { "value": "btn--secondary", "label": "Secondary" },
        { "value": "btn--outline", "label": "Outline" }
      ],
      "default": "btn--outline"
    },
    {
      "type": "header",
      "content": "Padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top Padding",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom Padding",
      "default": 36
    },
    {
      "type": "checkbox",
      "id": "show_section_divider",
      "label": "Show Divider",
      "default": false
    },
    {
      "type": "select",
      "id": "divider_width",
      "options": [
        { "value": "fixed", "label": "Fixed" },
        { "value": "full", "label": "Full" }
      ],
      "default": "fixed",
      "label": "Divider Width"
    }
  ],
  "presets": [
    {
      "name": "Featured Collection (Auragems)"
    }
  ]
}
{% endschema %}