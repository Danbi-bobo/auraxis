{{ 'product-auragems.css' | asset_url | stylesheet_tag }}

{%- assign product_form_id = 'product-form-' | append: section.id -%}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
    
    .auragems-product-grid-{{ section.id }} {
      grid-template-columns: {{ section.settings.media_width }}% 1fr;
    }
    
    {% if section.settings.media_position == 'right' %}
      .auragems-product-grid-{{ section.id }} .auragems-media-gallery { order: 2; }
      .auragems-product-grid-{{ section.id }} .auragems-product-info { order: 1; }
    {% endif %}
  }
{%- endstyle -%}

<div class="auragems-product-container page-width section-{{ section.id }}-padding">
  <div class="auragems-product-grid auragems-product-grid-{{ section.id }}">
    
    {%- comment -%} --- CỘT TRÁI: HÌNH ẢNH (GRID) --- {%- endcomment -%}
    <div class="auragems-media-gallery" id="Gallery-{{ section.id }}">
      {%- for media in product.media -%}
        <div class="auragems-media-item">
          <img
            src="{{ media | image_url: width: 1200 }}"
            alt="{{ media.alt | escape }}"
            loading="{% if forloop.first %}eager{% else %}lazy{% endif %}"
            width="{{ media.width }}"
            height="{{ media.height }}"
            class="product-image-display"
          >
        </div>
      {%- endfor -%}
    </div>

    {%- comment -%} --- CỘT PHẢI: THÔNG TIN (BLOCKS) --- {%- endcomment -%}
    <div class="auragems-product-info sticky-content">
      {%- for block in section.blocks -%}
        {%- case block.type -%}
          {%- when '@app' -%}
            {% render block %}
          
          {%- when 'vendor' -%}
            <div class="auragems-vendor" {{ block.shopify_attributes }}>{{ product.vendor }}</div>

          {%- when 'title' -%}
            <h1 class="auragems-title" {{ block.shopify_attributes }}>{{ product.title }}</h1>
          
          {%- when 'price' -%}
            <div class="auragems-price" {{ block.shopify_attributes }}>
              <span class="price-item price-item--regular">
                {{ product.price | money_with_currency }}
              </span>
              {%- if product.compare_at_price > product.price -%}
                <s class="auragems-compare-price">{{ product.compare_at_price | money }}</s>
              {%- endif -%}
            </div>

          {%- when 'variant_picker' -%}
            {%- unless product.has_only_default_variant -%}
              <variant-selects class="no-js-hidden" data-section="{{ section.id }}" data-url="{{ product.url }}" {{ block.shopify_attributes }}>
                {%- for option in product.options_with_values -%}
                  <div class="product-form__input">
                    <label class="form__label">{{ option.name }}</label>
                    <div class="select">
                      <select class="select__select" name="options[{{ option.name | escape }}]" form="{{ product_form_id }}">
                        {%- for value in option.values -%}
                          <option value="{{ value | escape }}" {% if option.selected_value == value %}selected="selected"{% endif %}>
                            {{ value }}
                          </option>
                        {%- endfor -%}
                      </select>
                      <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-caret" viewBox="0 0 10 6"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.354.646a.5.5 0 00-.708 0L5 4.293 1.354.646a.5.5 0 00-.708.708l4 4a.5.5 0 00.708 0l4-4a.5.5 0 000-.708z" fill="currentColor"></path></svg>
                    </div>
                  </div>
                {%- endfor -%}
                <script type="application/json">{{ product.variants | json }}</script>
              </variant-selects>
            {%- endunless -%}

          {%- when 'quantity_selector' -%}
            <div class="product-form__input product-form__quantity" {{ block.shopify_attributes }}>
              <label class="form__label" for="Quantity-{{ section.id }}">Số lượng</label>
              <div class="quantity-wrapper">
                <button name="minus" type="button" class="quantity__button" onclick="this.nextElementSibling.stepDown()">-</button>
                <input class="quantity__input"
                    type="number"
                    name="quantity"
                    id="Quantity-{{ section.id }}"
                    min="1"
                    value="1"
                    form="{{ product_form_id }}"
                  >
                <button name="plus" type="button" class="quantity__button" onclick="this.previousElementSibling.stepUp()">+</button>
              </div>
            </div>

          {%- when 'buy_buttons' -%}
            <div {{ block.shopify_attributes }}>
              {%- form 'product', product, id: product_form_id, class: 'form' -%}
                <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                <div class="product-form__buttons">
                  <button
                    type="submit"
                    name="add"
                    class="auragems-btn-add product-form__submit button button--full-width"
                    {% if product.selected_or_first_available_variant.available == false %}disabled{% endif %}
                  >
                    <span>
                      {%- if product.selected_or_first_available_variant.available -%}
                        Thêm vào giỏ hàng
                      {%- else -%}
                        Hết hàng
                      {%- endif -%}
                    </span>
                  </button>
                  {%- if block.settings.show_dynamic_checkout -%}
                    {{ form | payment_button }}
                  {%- endif -%}
                </div>
              {%- endform -%}
            </div>

          {%- when 'description' -%}
            <div class="auragems-description rte" {{ block.shopify_attributes }}>
              {{ product.description }}
            </div>

          {%- when 'text' -%}
            <div class="auragems-block-text {{ block.settings.text_style }}" {{ block.shopify_attributes }}>
              {{ block.settings.text }}
            </div>

          {%- when 'divider' -%}
            <hr class="auragems-divider" style="margin: {{ block.settings.margin_top }}px 0 {{ block.settings.margin_bottom }}px 0;" {{ block.shopify_attributes }}>

          {%- when 'share' -%}
            <div class="auragems-share" {{ block.shopify_attributes }}>
              <span class="share-label">Chia sẻ:</span>
              <a href="https://www.facebook.com/sharer.php?u={{ shop.url | append: product.url }}" target="_blank">Facebook</a>
              <a href="https://twitter.com/share?url={{ shop.url | append: product.url }}" target="_blank">Twitter</a>
              <a href="pinterest.com/pin/create/button/?url={{ shop.url | append: product.url }}" target="_blank">Pinterest</a>
            </div>

          {%- when 'popup' -%}
            <div class="auragems-popup-link" {{ block.shopify_attributes }}>
              <button id="PopupTrigger-{{ section.id }}" type="button" class="popup-trigger-btn">
                {{ block.settings.link_label }}
              </button>
            </div>
            <div id="PopupModal-{{ section.id }}" class="auragems-modal hidden">
              <div class="auragems-modal-content">
                <span class="close-modal">&times;</span>
                <h2>{{ block.settings.page.title }}</h2>
                <div class="rte">{{ block.settings.page.content }}</div>
              </div>
            </div>
            <script>
              document.getElementById('PopupTrigger-{{ section.id }}').onclick = function() {
                document.getElementById('PopupModal-{{ section.id }}').style.display = 'block';
              }
              document.querySelector('#PopupModal-{{ section.id }} .close-modal').onclick = function() {
                document.getElementById('PopupModal-{{ section.id }}').style.display = 'none';
              }
            </script>

          {%- when 'collapsible_tab' -%}
            <div class="auragems-accordion" {{ block.shopify_attributes }}>
              <details>
                <summary>
                  <div class="summary-title">
                    {% render 'icon-with-text', icon: block.settings.icon %}
                    <span>{{ block.settings.heading | default: block.settings.page.title }}</span>
                  </div>
                  {% render 'icon-caret' %}
                </summary>
                <div class="accordion-content rte">
                  {{ block.settings.content }}
                  {{ block.settings.page.content }}
                </div>
              </details>
            </div>
            
        {%- endcase -%}
      {%- endfor -%}
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Auragems Full Modular",
  "tag": "section",
  "class": "section",
  "settings": [
    { "type": "header", "content": "Bố cục chung" },
    { "type": "select", "id": "media_position", "options": [ { "value": "left", "label": "Ảnh bên trái" }, { "value": "right", "label": "Ảnh bên phải" } ], "default": "left", "label": "Vị trí ảnh (Desktop)" },
    { "type": "range", "id": "media_width", "min": 40, "max": 75, "step": 5, "unit": "%", "label": "Độ rộng cột ảnh", "default": 60 },
    { "type": "range", "id": "padding_top", "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Padding Top", "default": 36 },
    { "type": "range", "id": "padding_bottom", "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Padding Bottom", "default": 36 }
  ],
  "blocks": [
    { "type": "@app" },
    { "type": "vendor", "name": "Tên thương hiệu", "limit": 1 },
    { "type": "title", "name": "Tên sản phẩm", "limit": 1 },
    { "type": "price", "name": "Giá", "limit": 1 },
    { "type": "variant_picker", "name": "Bộ chọn biến thể", "limit": 1 },
    { "type": "quantity_selector", "name": "Chọn số lượng", "limit": 1 },
    { 
      "type": "buy_buttons", 
      "name": "Nút mua hàng", 
      "limit": 1,
      "settings": [
        { "type": "checkbox", "id": "show_dynamic_checkout", "default": true, "label": "Hiển thị nút mua ngay (Paypal/GPay)" }
      ]
    },
    { "type": "description", "name": "Mô tả sản phẩm", "limit": 1 },
    { "type": "share", "name": "Nút chia sẻ", "limit": 1 },
    { 
      "type": "text", 
      "name": "Đoạn văn bản (Text)", 
      "settings": [ 
        { "type": "text", "id": "text", "default": "Thông tin bổ sung", "label": "Nội dung" },
        { "type": "select", "id": "text_style", "options": [ { "value": "body", "label": "Body" }, { "value": "subtitle", "label": "Subtitle" }, { "value": "uppercase", "label": "Uppercase" } ], "default": "body", "label": "Kiểu chữ" }
      ] 
    },
    { 
      "type": "divider", 
      "name": "Đường kẻ ngang", 
      "settings": [ { "type": "range", "id": "margin_top", "min": 0, "max": 50, "step": 5, "unit": "px", "label": "Margin Top", "default": 20 }, { "type": "range", "id": "margin_bottom", "min": 0, "max": 50, "step": 5, "unit": "px", "label": "Margin Bottom", "default": 20 } ] 
    },
    {
      "type": "popup",
      "name": "Popup (Hướng dẫn size)",
      "settings": [
        { "type": "text", "id": "link_label", "default": "Hướng dẫn chọn size", "label": "Chữ hiển thị" },
        { "type": "page", "id": "page", "label": "Chọn trang nội dung" }
      ]
    },
    { 
      "type": "collapsible_tab", 
      "name": "Tab thông tin (Accordion)", 
      "settings": [ 
        { "type": "text", "id": "heading", "default": "Chính sách vận chuyển", "label": "Tiêu đề" }, 
        { "type": "richtext", "id": "content", "label": "Nội dung tab" }, 
        { "type": "page", "id": "page", "label": "Hoặc chọn từ Page" },
        { "type": "select", "id": "icon", "options": [ { "value": "none", "label": "None" }, { "value": "check_mark", "label": "Check Mark" }, { "value": "ruler", "label": "Ruler" }, { "value": "truck", "label": "Truck" }, { "value": "return", "label": "Return" } ], "default": "check_mark", "label": "Icon" }
      ] 
    }
  ]
}
{% endschema %}